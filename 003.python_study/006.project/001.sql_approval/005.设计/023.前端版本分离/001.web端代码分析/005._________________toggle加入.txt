
//==============================================ï¼ˆ1ï¼‰å®šä¹‰toggleæ–‡ä»¶
//==============================================ï¼ˆ1ï¼‰å®šä¹‰toggleæ–‡ä»¶
//==== ä¸åŒç¯å¢ƒå„è‡ªå®šä¹‰ä¸€ä¸ªtoggle.js æ–‡ä»¶
//==== ä¸åŒç¯å¢ƒå„è‡ªå®šä¹‰ä¸€ä¸ªtoggle.js æ–‡ä»¶

toggles/localhost/toggle.js //æœ¬åœ°è¿è¡Œ
toggles/xyjt/toggle.js	  //xyjtç¯å¢ƒ
toggles/cqyh/toggle.js	  //cqyhç¯å¢ƒ

//=============== localhostçš„ toggle.js
//=============== localhostçš„ toggle.js
{
   "showNewBanner": true,
   "enableBetaChat": true,
   "useDarkModeByDefault": true,
   "enabledFeatures": ["a", "b", "c"],
   "defaultVisibleMenus": ["home", "dashboard"]

    "titles": {
	  "home": "é¦–é¡µ",
	  "dashboard": "ä»ªè¡¨ç›˜"
	}
}
//=============== cqyh çš„ toggle.js
//=============== cqyh çš„ toggle.js
{
   "showNewBanner": true,
   "enableBetaChat": false,
   "useDarkModeByDefault": true,
   "enabledFeatures": ["a", "b"],
   "defaultVisibleMenus": ["home", "dashboard"]

    "titles": {
	  "home": "é¦–é¡µ",
	  "dashboard": "ä»ªè¡¨ç›˜"
	}
}
//=============== xyjt çš„ toggle.js
//=============== xyjt çš„ toggle.js
{
   "showNewBanner": false,
   "enableBetaChat": false,
   "useDarkModeByDefault": true,
   "enabledFeatures": ["b", "c"],
   "defaultVisibleMenus": ["home", "dashboard"]

    "titles": {
	  "home": "é¦–é¡µ",
	  "dashboard": "ä»ªè¡¨ç›˜"
	}
}



//==============================================ï¼ˆ2ï¼‰Webpack é…ç½®ï¼ˆç®€åŒ–ï¼‰
//==============================================ï¼ˆ2ï¼‰Webpack é…ç½®ï¼ˆç®€åŒ–ï¼‰

DefinePluginï¼ˆæ’ä»¶ï¼‰ æŠŠ __FEATURE_TOGGLE__ ç¼–è¯‘è¿›æ‰“åŒ…åçš„è¿è¡Œæ—¶ä»£ç é‡Œï¼Œè®©æµè§ˆå™¨é‡Œ window.__FEATURE_TOGGLE__ å®é™…å­˜åœ¨ã€‚
æ˜¯åœ¨ æ‰“åŒ…é˜¶æ®µï¼ˆWebpack æ„å»ºæ—¶ï¼‰æŠŠä½ çš„ toggles å¯¹è±¡æ³¨å…¥åˆ°å‰ç«¯ä»£ç é‡Œï¼Œè®©æµè§ˆå™¨ç«¯èƒ½å¤Ÿé€šè¿‡ __FEATURE_TOGGLE__ ç›´æ¥è®¿é—®è¿™äº›é…ç½®å€¼ã€‚

    //====================== è¯»å–ç¯å¢ƒå˜é‡ï¼Œä¿è¯å‰ç«¯ä»£ç èƒ½ä½¿ç”¨ __FEATURE_TOGGLE__
    //====================== è¯»å–ç¯å¢ƒå˜é‡ï¼Œä¿è¯å‰ç«¯ä»£ç èƒ½ä½¿ç”¨ __FEATURE_TOGGLE__
 
    //====================== è¯»å–ç¯å¢ƒå˜é‡
    //====================== è¯»å–ç¯å¢ƒå˜é‡
	   const toggleEnv = process.env.TOGGLE_ENV || 'localhost';
		console.log('ğŸ”§ TOGGLE_ENV is', process.env.TOGGLE_ENV);
		const path = require('path');
		const togglePath = path.resolve(
		  process.cwd(),
		  'config',
		  'toggle',
		  toggleEnv,
		  'toggle.js',
		);
		console.log('ğŸ”§ togglePath iss', togglePath);    
		const toggles = require(togglePath);


		config.plugin('define').tap(([definitions]: any[]) => {
		  return [
			{
			  ...definitions,
			  __FEATURE_TOGGLE__: JSON.stringify(toggles),
			},
		  ];
		});
  
//==============================================ï¼ˆ3ï¼‰è¡¥å……
//==============================================ï¼ˆ3ï¼‰è¡¥å……


ç”±äº  config.ts å¼•å…¥äº† defaultSettings.ts


import defaultSettings, { isMicroservice } from './defaultSettings';

è€Œ defaultSettings é‡Œé¢ä¹Ÿéœ€è¦ä½¿ç”¨ toggle çš„å†…å®¹

æ‰€ä»¥åœ¨ defaultSettings.ts é‡Œé¢ï¼Œä½†è¦ç»™é»˜è®¤å€¼ï¼Œå› ä¸ºå®ƒå…ˆæ‰§è¡Œ

declare const __FEATURE_TOGGLE__: any; 
const toggles =
  typeof __FEATURE_TOGGLE__ !== 'undefined'
    ? __FEATURE_TOGGLE__
    : {
        navBarTitle: 'é»˜è®¤æ ‡é¢˜'  //ä½†è¦ç»™é»˜è®¤å€¼ï¼Œå› ä¸ºå®ƒå…ˆæ‰§è¡Œ
      };



//==============================================ï¼ˆ4ï¼‰ä½¿ç”¨
//==============================================ï¼ˆ4ï¼‰ä½¿ç”¨


title:  __FEATURE_TOGGLE__.navBarTitle,




// src/App.jsx
import React from 'react';

export default function App() {
  return (
    <div>
      {__FEATURE_TOGGLE__.showNewBanner && (
        <Banner>æ¬¢è¿ä½“éªŒæ–°åŠŸèƒ½ï¼</Banner>
      )}
      {/* â€¦ */}
    </div>
  );
}




//==============================================ï¼ˆ5ï¼‰ç»™å¯åŠ¨åŠ å…¥å‚æ•°
//==============================================ï¼ˆ5ï¼‰ç»™å¯åŠ¨åŠ å…¥å‚æ•°

//============== package.json
//============== package.json
{
  "scripts": {
    "build:localhost": "webpack --env TOGGLE_ENV=localhost",
    "build:cqyh":      "webpack --env TOGGLE_ENV=cqyh",
    "build:xyjt":      "webpack --env TOGGLE_ENV=xyjt"
  }
}
è¿è¡Œ npm run build:localhost æ—¶ï¼Œenv.TOGGLE_ENV === 'localhost'ï¼Œå°±ä¼šåŠ è½½ ./localhost/toggle.jsonã€‚

è¿è¡Œ npm run build:cqyh æ—¶ï¼Œenv.TOGGLE_ENV === 'cqyh'ï¼Œå°±ä¼šåŠ è½½ ./cqyh/toggle.jsonã€‚



