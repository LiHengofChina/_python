

âœ” Schema æœ¬èº«ä¸è¿æ¥æ•°æ®åº“
âœ” JdbcSchema æ˜¯ Schema çš„â€œè¿æ¥æ•°æ®åº“ç‰ˆæœ¬â€ï¼Œå®ƒä¼šè®¿é—®çœŸå®æ•°æ®åº“å¹¶åŠ è½½è¡¨ç»“æ„


//============================================================================== JdbcSchema
//============================================================================== JdbcSchema

JdbcSchema æ˜¯ Calcite è‡ªå¸¦çš„ã€èƒ½å¤Ÿé€šè¿‡ JDBC è¿æ¥ "çœŸå®æ•°æ®åº“" å¹¶æŠŠæ•°æ®åº“çš„ "è¡¨ç»“æ„è‡ªåŠ¨æ˜ å°„è¿› Schema çš„å®ç°"ã€‚

æ¢å¥è¯è¯´ï¼š
	âœ” ä½ ä¸ç”¨è‡ªå·±å†™ Table/Schema
	âœ” Calcite ä¼šè‡ªåŠ¨å»æ•°æ®åº“é‡Œè¯»è¡¨ç»“æ„
	âœ” è‡ªåŠ¨æŠŠè¡¨åã€åˆ—åã€ç±»å‹ç­‰æ³¨å†Œè¿› Schema æ ‘
	âœ” Validator / Parser / SqlToRel éƒ½èƒ½ç›´æ¥ç”¨è¿™äº›çœŸå®ä¿¡æ¯


//============================================================================== JdbcSchema å®ƒæœ‰ä¸¤ä¸ªä¸»è¦æ–¹æ³•
//============================================================================== JdbcSchema å®ƒæœ‰ä¸¤ä¸ªä¸»è¦æ–¹æ³•


ï¼ˆ1ï¼‰JdbcSchema.dataSource  ç”¨æ¥åˆ›å»ºæ•°æ®æºçš„
ï¼ˆ2ï¼‰JdbcSchema.create		ç”¨æ¥åˆ›å»ºJdbcSchemaå®ä¾‹çš„

	/**
		 å‚æ•°ï¼š
		public static JdbcSchema create(
				
				SchemaPlus parentSchema,		//æ ¹èŠ‚ç‚¹SchemaPlus root = Frameworks.createRootSchema(true);
				
				String name, 					//Calcite ä¸­å±•ç¤ºå‡ºæ¥çš„ Schema åç§°ï¼Œä¹Ÿå°±æ˜¯ SQL é‡Œå¼•ç”¨æ—¶ç”¨çš„åç§°ã€‚
												SchemaPlus root = Frameworks.createRootSchema(true);
												root.add("testDB", jdbcSchema);
												SchemaPlus root = Frameworks.createRootSchema(true);
												root.add("testDB", jdbcSchema);
												//åé¢ SQL é‡Œç”¨çš„å°±æ˜¯ï¼š
												åé¢ SQL é‡Œç”¨çš„å°±æ˜¯ï¼š


				DataSource dataSource,			// DataSource dataSource

				String catalog,					//ï¼ˆæ•°æ®åº“ catalog åï¼Œå¯ä»¥ä¸º nullï¼‰//å¯¹åº” JDBC ä¸­çš„ catalogï¼ˆæ•°æ®åº“ / catalog æ¦‚å¿µï¼‰ã€‚

				String schema)					//è¿™ä¸ª JDBC Schema åœ¨çœŸå®æ•°æ®åº“ä¸­å¯¹åº”çš„ schema åï¼Œå¦‚ï¼šuse testdb;ã€‚


	*/



//============================================================================== JdbcSchema çš„è§’è‰²ï¼ˆç®€å•ç‰ˆæœ¬ï¼‰
//============================================================================== JdbcSchema çš„è§’è‰²ï¼ˆç®€å•ç‰ˆæœ¬ï¼‰

å®ƒåšä¸‰ä»¶äº‹ï¼š
	ï¼ˆ1ï¼‰é€šè¿‡ JDBC è¿æ¥æ•°æ®åº“ï¼ˆä½ ç»™å®ƒ DataSourceï¼‰
	ï¼ˆ2ï¼‰è¯»å–åº“é‡Œçš„æ‰€æœ‰è¡¨ç»“æ„ï¼ˆmetadataï¼‰
	ï¼ˆ3ï¼‰æŠŠè¿™äº›è¡¨å˜æˆ Calcite çš„ Tableï¼Œå¹¶æ”¾å…¥ Schema æ ‘


//========================== å¸¸è§ç”¨æ³•
//========================== å¸¸è§ç”¨æ³•

DataSource ds = JdbcSchema.dataSource(
        "jdbc:mysql://localhost:3306/test",
        "com.mysql.cj.jdbc.Driver",
        "root",
        "123456");

SchemaPlus root = Frameworks.createRootSchema(true);

// è‡ªåŠ¨åŠ è½½ test åº“ä¸‹æ‰€æœ‰è¡¨
root.add("test", JdbcSchema.create(root, "test", ds, null, null));

//========================== ç¤ºä¾‹ï¼šJdbcSchemaï¼ˆJDBC æ–¹å¼ï¼‰
//========================== ç¤ºä¾‹ï¼šJdbcSchemaï¼ˆJDBC æ–¹å¼ï¼‰

é€šè¿‡ JDBC è®¿é—®æ•°æ®åº“ï¼Œå¦‚ MySQLã€PostgreSQLã€Oracle ç­‰ã€‚
DataSource dataSource = JdbcSchema.dataSource(
	"jdbc:mysql://localhost:3306/test", 
	"com.mysql.cj.jdbc.Driver", 
	"root", "password"
);
Schema jdbcSchema = JdbcSchema.create(rootSchema, "MY_SCHEMA", dataSource, null, null);

3. AbstractSchemaï¼ˆåŸºç±»ï¼‰
	æä¾›åŸºç¡€ Schema ç»“æ„ï¼Œç”¨äºæ‰©å±•è‡ªå®šä¹‰ Schemaã€‚

4. MapSchemaï¼ˆåŸºäº Map çš„ Schemaï¼‰
	é€‚ç”¨äº å†…å­˜è¡¨ï¼Œå¯ä»¥æ‰‹åŠ¨åˆ›å»ºè¡¨ã€‚

5. SchemaPlusï¼ˆå¢å¼º Schemaï¼‰
	ç»§æ‰¿ Schemaï¼Œå¢åŠ  å±‚çº§ç®¡ç†ã€åŠ¨æ€æ‰©å±• çš„èƒ½åŠ›ã€‚

//========================== ç¤ºä¾‹
//========================== ç¤ºä¾‹

åˆ›å»ºä¸€ä¸ªåŒ…å«è¡¨çš„ Schema

SchemaPlus rootSchema = Frameworks.createRootSchema(true);
SchemaPlus mySchema = rootSchema.add("MY_SCHEMA", new CustomSchema());

System.out.println(mySchema.getTableNames()); // è·å–æ‰€æœ‰è¡¨å
æ€»ç»“
ï¼ˆ1ï¼‰Schema ä»£è¡¨æ•°æ®åº“ç»“æ„ï¼Œå­˜å‚¨è¡¨ã€è§†å›¾ã€å‡½æ•°ç­‰ä¿¡æ¯ã€‚
ï¼ˆ2ï¼‰JdbcSchema ç”¨äº JDBC æ•°æ®åº“ï¼ŒMapSchema ç”¨äºå†…å­˜æ•°æ®åº“ã€‚
ï¼ˆ3ï¼‰SchemaPlus æ˜¯å¢å¼ºç‰ˆ Schemaï¼Œæ”¯æŒåŠ¨æ€æ·»åŠ è¡¨ã€è§†å›¾ç­‰ã€‚

ğŸ‘‰ åœ¨ Calcite SQL è§£æ æ—¶ï¼ŒSchema è´Ÿè´£æä¾›æ•°æ®åº“ è¡¨ç»“æ„å’Œæ•°æ®æºï¼Œ
å¸®åŠ© SQL è¯­å¥æ­£ç¡®è§£ææ‰§è¡Œã€‚


åˆ›å»º JDBC æ•°æ®æºï¼ˆMySQLï¼‰

//============================================================================= ä½¿ç”¨ JdbcSchema.dataSource åˆ›å»º JDBC æ•°æ®æºï¼ˆMySQLï¼‰
//============================================================================= ä½¿ç”¨ JdbcSchema.dataSource åˆ›å»º JDBC æ•°æ®æºï¼ˆMySQLï¼‰

JdbcSchema.dataSource(...) ä¼šå¸®ä½ åˆ›å»ºä¸€ä¸ª JDBC æ•°æ®æºï¼ˆDataSourceï¼‰ï¼Œ
å®ƒè¿”å›çš„å°±æ˜¯ Java æ ‡å‡† JDBC çš„é¡¶å±‚æ¥å£ javax.sql.DataSourceã€‚

/**
	âœ” Calcite ä¸è‡ªå·±å®ç°æ•°æ®æº
	âœ” å®ƒåªæ˜¯å¸®ä½ åˆ›å»ºä¸€ä¸ª æ ‡å‡†çš„ JDBC DataSource
	âœ” è¿™ä¸ª DataSource å®Œå…¨ç¬¦åˆ Java çš„ JDBC è§„èŒƒ
	âœ” Calcite ç”¨å®ƒæ¥è·å–è¿æ¥ï¼ˆConnectionï¼‰å¹¶è¯»å–æ•°æ®åº“ metadata
*/

//===============================================
//===============================================

//ï¼ˆ1ï¼‰ä½¿ç”¨ JdbcSchema.dataSource(...) åˆ›å»º JDBC æ•°æ®æºï¼Œ
// æä¾›æ•°æ®åº“è¿æ¥ä¿¡æ¯ã€‚
DataSource dataSource = JdbcSchema.dataSource(
        "jdbc:mysql://192.168.100.231:3306/test_liheng",
        "com.mysql.cj.jdbc.Driver",
        "root",
        "-ir2dtd?XFf>"
);


//ï¼ˆ2ï¼‰åˆ›å»º SchemaPlusï¼Œç”¨äºå­˜æ”¾æ•°æ®åº“ Schemaã€‚
SchemaPlus rootSchemaPlus = Frameworks.createRootSchema(true);


//ï¼ˆ3ï¼‰å°† JDBC Schema æ·»åŠ åˆ° `rootSchemaPlus`
rootSchemaPlus.add(
        "MY_SCHEMA", 
        JdbcSchema.create(rootSchemaPlus, "MY_SCHEMA", dataSource, null, null)
);


åˆ›å»ºäº† ä¸€ä¸ªåŒ…å« MySQL æ•°æ®åº“ test_liheng çš„ Schemaï¼ŒCalcite è§£æ SQL æ—¶ï¼Œ
å°±å¯ä»¥é€šè¿‡ MY_SCHEMA è®¿é—®æ•°æ®åº“è¡¨ã€‚

