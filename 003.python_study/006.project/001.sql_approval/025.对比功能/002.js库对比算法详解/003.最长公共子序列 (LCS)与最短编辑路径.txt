
//=================================================== æ¦‚å¿µ
//=================================================== æ¦‚å¿µ

æ±‚"æœ€é•¿å…¬å…±å­åºåˆ—" å’Œ "æœ€çŸ­ç¼–è¾‘è·¯å¾„" å®ƒä»¬æ˜¯ä¸¤ä¸ªæ¦‚å¿µ

	ï¼ˆ1ï¼‰æœ€é•¿å…¬å…±å­åºåˆ— (LCS)ï¼šæ‰¾ä¸¤ä¸ªåºåˆ—é‡Œ "å…±åŒçš„æœ€é•¿éƒ¨åˆ†" ã€‚
	ï¼ˆ2ï¼‰æœ€çŸ­ç¼–è¾‘è·¯å¾„ (Edit Distance)ï¼šæ‰¾æŠŠ A å˜æˆ B æ‰€éœ€çš„ "æœ€å°‘æ“ä½œæ•°"ã€‚

//=================================================== å…³ç³»ï¼š
//=================================================== å…³ç³»ï¼š

æœ€çŸ­ç¼–è¾‘è·¯å¾„ = A é•¿åº¦ + B é•¿åº¦ âˆ’ 2 Ã— LCS é•¿åº¦ã€‚

æ‰€ä»¥ä¸¤è€…æ˜¯ä¸åŒè§’åº¦ï¼Œä½†æ•°å­¦ä¸Šæ˜¯å…³è”çš„ã€‚

//===================================================
//===================================================

æœ€çŸ­ç¼–è¾‘è·¯å¾„ çš„è®¡ç®—æœ¬è´¨ä¸Šä¾èµ–äº æœ€é•¿å…¬å…±å­åºåˆ— (LCS)ï¼š

å…¬å…±éƒ¨åˆ†ï¼ˆLCSï¼‰ä¸éœ€è¦æ”¹åŠ¨ã€‚
éå…¬å…±éƒ¨åˆ†æ‰éœ€è¦æ’å…¥æˆ–åˆ é™¤ã€‚

å…¬å¼å°±æ˜¯ï¼š
	æœ€çŸ­ç¼–è¾‘è·¯å¾„é•¿åº¦ = |A| + |B| âˆ’ 2 Ã— |LCS|ã€‚

//=================================================== æˆ‘çš„åº”ç”¨
//=================================================== æˆ‘çš„åº”ç”¨
æˆ‘æ±‚ä¸¤ä¸ªæ–‡æœ¬ç›¸ä¼¼åº¦ï¼Œ

	ï¼ˆ1ï¼‰ä¼ å…¥å®Œæ•´æ–‡æœ¬ä¹Ÿæ˜¯åˆç†çš„
			//å®Œå…¨åˆç† ğŸ‘ã€‚ç›´æ¥ç”¨å…¨æ–‡è·‘ LCS / æœ€çŸ­ç¼–è¾‘è·¯å¾„ï¼Œå°±èƒ½è¡¡é‡æ•´ä½“ç›¸ä¼¼åº¦ã€‚

	ï¼ˆ2ï¼‰åœ¨ä¼ å…¥ä¹‹å‰æ’åºç­‰å¤„ç†ä¹Ÿæ˜¯åˆç†çš„
			//å¦‚æœæ¯”è¾ƒçš„æ˜¯â€œå†…å®¹é›†åˆâ€ï¼ˆé¡ºåºä¸é‡è¦ï¼‰ï¼Œæ’åºåå†æ¯”æ›´åˆç†ã€‚
			//å¦‚æœæ¯”è¾ƒçš„æ˜¯â€œé¡ºåºæ•æ„Ÿâ€çš„æ–‡æœ¬ï¼ˆä»£ç ã€è¯­å¥ï¼‰ï¼Œå°±ä¸è¦æ‰“ä¹±é¡ºåºã€‚

//=================================================== ä¸ºä»€ä¹ˆæˆ‘çš„ç»“æœå°±æœ‰äº›æ˜¯ä¸€è¡Œçš„å†…å®¹è¢«æ‹†åˆ†äº†
//=================================================== ä¸ºä»€ä¹ˆæˆ‘çš„ç»“æœå°±æœ‰äº›æ˜¯ä¸€è¡Œçš„å†…å®¹è¢«æ‹†åˆ†äº†

	ç”±äºæ˜¯ "æœ€çŸ­ç¼–è¾‘è·¯å¾„" å¦‚ ABC â†’ AC â†’ ACDï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šæ­¥éª¤ï¼Œ
	æ‰€ä»¥ä¸­é€”æ‰€ä»¥æˆ‘å®Œæ•´çš„è¡Œæˆ–æœ‰äº›ä¸€èµ·çš„å†…å®¹ï¼Œ
	è¢«è¿™ä¸ªç®—æ³• ç»™æ‹†åˆ†äº†ï¼Œå®é™…æ‹†åˆ†çš„å°±æ˜¯å®ƒçš„æ­¥æ•°
	//============
	//============
	çœ‹åˆ° ABC â†’ AC â†’ ACD è¿™ç§ï¼Œå°±æ˜¯ æœ€çŸ­ç¼–è¾‘è·¯å¾„çš„ä¸€æ¡ "é€æ­¥æ“ä½œåºåˆ—"ã€‚
	æ¯ä¸€æ­¥ï¼ˆåˆ  Bã€åŠ  Dï¼‰å°±æ˜¯ä¸€æ¬¡ ç¼–è¾‘æ“ä½œã€‚
	è¿™äº›æ“ä½œè¿èµ·æ¥ï¼Œå°±æ„æˆäº† "ç®—æ³•çš„è·¯å¾„" ã€‚
	æ‰€ä»¥æŸäº›è¿ç»­çš„å†…å®¹è¢« "æ‹†å¼€"ï¼Œ æ­£æ˜¯å› ä¸ºç®—æ³•è¦æŠŠå®ƒä»¬ä¸€æ­¥æ­¥è½¬æ¢ï¼Œä¸­é—´çš„æ¯ä¸ªåŠ¨ä½œéƒ½ç®—ä¸€æ­¥ã€‚
	"è¢«æ‹†åˆ†ï¼Œå…¶å®å°±æ˜¯ ç®—æ³•åœ¨è®°å½•æœ€çŸ­è·¯å¾„çš„æ¯ä¸ªæ“ä½œæ­¥éª¤ã€‚"
	//============
	//============
	æœ€åæˆ‘é€šè¿‡æˆ‘çš„ä»£ç ï¼Œå¤„ç†è¿˜åŸå®ƒæ‹†åˆ†çš„å†…å®¹ï¼Œä¹Ÿæ˜¯åˆç†çš„
	åœ¨ä»£ç é‡ŒæŠŠæ‹†åˆ†çš„ç‰‡æ®µå†åˆå¹¶è¿˜åŸï¼Œå®Œå…¨åˆç†ã€‚

//=================================================== æˆ‘çš„ä»£ç åˆ†æï¼šä»£ç ç‰‡æ®µ1
//=================================================== æˆ‘çš„ä»£ç åˆ†æï¼šä»£ç ç‰‡æ®µ1


Value diffLines = context.eval("js",
		"(a, b) => Diff.diffWordsWithSpace(a, b, { delimiters: /[ \\t\\r\\n]+/ })"
);

è¿™æ®µä»£ç è°ƒç”¨çš„æ˜¯ diffWordsWithSpaceï¼Œ
å®ƒå†…éƒ¨è¿˜æ˜¯åŸºäº "Myers O(ND) ç®—æ³•" æ¥ç®— "æœ€çŸ­ç¼–è¾‘è·¯å¾„"ï¼Œ
åªæ˜¯ç»“æœè¢«å°è£…æˆäº† "å·®å¼‚å—æ•°ç»„"ï¼ˆå“ªäº›éƒ¨åˆ†ç›¸åŒã€å“ªäº›æ–°å¢ã€å“ªäº›åˆ é™¤ï¼‰ã€‚

æ‰€ä»¥æ‹¿åˆ°çš„ resultï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ "æœ€çŸ­ç¼–è¾‘è·¯å¾„çš„ç»“æ„åŒ–ç»“æœ"ã€‚


//=================== åˆ†éš”ç¬¦çš„ä½œç”¨
//=================== åˆ†éš”ç¬¦çš„ä½œç”¨

"(a, b) => Diff.diffWordsWithSpace(a, b, { delimiters: /[ \\t\\r\\n]+/ })" 
è¿™é‡ŒæŒ‡å®šäº†åˆ†éš”ç¬¦å·ï¼Œå®ƒåœ¨ Myers O(ND) ç®—æ³• ä¸­èµ·ä»€ä¹ˆä½œç”¨å‘¢

å…ˆæŠŠæ–‡æœ¬æŒ‰åˆ†éš”ç¬¦åˆ‡æˆâ€œæœ€å°å•å…ƒâ€ï¼Œç„¶åå†ç”¨ Myers O(ND) ç®—æ³• å»æ¯”å¯¹è¿™äº›å•å…ƒã€‚
//åˆ†éš”ç¬¦å†³å®šäº†â€œæ¯”è¾ƒçš„ç²’åº¦â€ï¼ˆæŒ‰å•è¯ã€æŒ‰è¡Œã€è¿˜æ˜¯æŒ‰å­—ç¬¦ï¼‰ã€‚

//=================== åœ¨æ¯”è¾ƒä¹‹å‰å…ˆåˆ‡åˆ†æˆå°å•å…ƒ
//=================== åœ¨æ¯”è¾ƒä¹‹å‰å…ˆåˆ‡åˆ†æˆå°å•å…ƒ

//ä¸¾ä¸ªä¾‹å­ï¼š
	ï¼ˆ1ï¼‰å¦‚æœä¸åˆ‡åˆ† â†’ ç®—æ³•ç›´æ¥æŒ‰å­—ç¬¦æ¯”è¾ƒï¼š "hello world"
	ï¼ˆ2ï¼‰å¦‚æœæŒ‡å®šç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦ â†’ ç®—æ³•å°±æŠŠå®ƒåˆ‡æˆå•å…ƒï¼š
			["hello", "world"]ï¼Œå†æŠŠè¿™ä¸¤ä¸ªæ•°ç»„ä¸¢ç»™ Myers ç®—æ³•ã€‚
//è°å’Œè°æ¯”è¾ƒï¼Ÿ
	å°å•å…ƒåºåˆ—å’Œå°å•å…ƒåºåˆ—æ¯”è¾ƒã€‚
	è¿™æ ·å°±ç®€åŒ–äº†ï¼Œå› ä¸ºç®—æ³•ä¸ç”¨å¤„ç†"æ‰€æœ‰å­—ç¬¦"ï¼Œè€Œæ˜¯å¤„ç†"å•å…ƒåºåˆ—"ï¼Œ
	ç»“æœæ›´ç¬¦åˆ"äººç±»ç†è§£çš„å·®å¼‚"ï¼ˆæ¯”å¦‚æŒ‰è¯æˆ–æŒ‰è¡Œå¯¹æ¯”ï¼‰ã€‚
//=================================================== æˆ‘çš„ä»£ç åˆ†æï¼šä»£ç ç‰‡æ®µ2
//=================================================== æˆ‘çš„ä»£ç åˆ†æï¼šä»£ç ç‰‡æ®µ2
	 for (int i = 0; i < result.getArraySize(); i++) {
		 
			Value part = result.getArrayElement(i);
			String value = part.getMember("value").asString();
			boolean added = part.hasMember("added") && part.getMember("added").asBoolean();
			boolean removed = part.hasMember("removed") && part.getMember("removed").asBoolean();

			String[] lines = value.split("\n", -1);
			for (int j = 0; j < lines.length; j++) {
					if (j > 0) {
						sourceLines.add("");
						targetLines.add("");
					}
					int currentLineIndex = sourceLines.size() - 1;

					if (added) {
						targetLines.set(currentLineIndex, targetLines.get(currentLineIndex) + lines[j]);
					} else if (removed) {
						sourceLines.set(currentLineIndex, sourceLines.get(currentLineIndex) + lines[j]);
					} else {
						sourceLines.set(currentLineIndex, sourceLines.get(currentLineIndex) + lines[j]);
						targetLines.set(currentLineIndex, targetLines.get(currentLineIndex) + lines[j]);
					}
			}
	}
	/**
	ï¼ˆ1ï¼‰è¿™æ®µä»£ç å°±æ˜¯åœ¨å¾ªç¯éå†  "å·®å¼‚å—" çš„æ¯ä¸€æ­¥ç»“æœï¼ˆadded / removed / ç›¸åŒï¼‰
	
	ï¼ˆ2ï¼‰for (int i = 0; i < result.getArraySize(); i++) { è¿™é‡Œå¾ªç¯çš„æ˜¯ "å·®å¼‚å—" çš„æ•°é‡
	
	ï¼ˆ3ï¼‰for (int j = 0; j < lines.length; j++) { //diff åº“è¿”å›çš„ value æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª å·®å¼‚å—ï¼ˆchunkï¼‰ï¼Œ	
												  //æ¯ä¸ªå·®å¼‚å—é‡Œå…·ä½“çš„å†…å®¹ï¼ˆé€è¡Œæ‹†åˆ†åçš„è¯´æ˜ï¼‰
														

	
	ï¼ˆ3ï¼‰æ³¨æ„******************
				æœ€çŸ­ç¼–è¾‘è·¯å¾„ åªå‘Šè¯‰ä½  "æœ€å°‘è¦å¤šå°‘æ­¥" æŠŠ A å˜æˆ Bï¼Œ
				ä½† "å·®å¼‚å—æ•°é‡" æ˜¯åº“åœ¨å°è£…ç»“æœæ—¶ï¼Œä¸ºäº†å±•ç¤ºå¯è¯»æ€§è€Œåˆ†ç»„å‡ºæ¥çš„ï¼ŒäºŒè€…æ²¡æœ‰ä¸€ä¸€å¯¹åº”å…³ç³»ã€‚


	ï¼ˆ3ï¼‰ä»¥ ABC ä¸ ACD æ¯”è¾ƒä¸ºä¾‹
		 æœ€çŸ­ç¼–è¾‘è·¯å¾„ï¼š ABC â†’ AC â†’ ACD 

		 //=================== å·®å¼‚å—æ•°é‡
		 ä»¥  const result = diffWords('ABC', 'ACD'); console.log(result); ä¸ºä¾‹å­
		ï¼ˆ1ï¼‰{ value: 'A' } â†’ åŒæ—¶å†™å…¥ sourceLines å’Œ targetLinesã€‚
		ï¼ˆ2ï¼‰{ value: 'B', removed: true } â†’ åªå†™å…¥ sourceLinesã€‚
		ï¼ˆ3ï¼‰{ value: 'C' } â†’ åŒæ—¶å†™å…¥ sourceLines å’Œ targetLinesã€‚
		ï¼ˆ4ï¼‰{ value: 'D', added: true } â†’ åªå†™å…¥ targetLinesã€‚
		 //=================== ç»“æœ
			A  A
			B  
			C  C
			   D

	*/
//===================================================  value.split("\n", -1); è¿™é‡Œä¸ºä»€ä¹ˆè¦ \n
//===================================================  value.split("\n", -1); è¿™é‡Œä¸ºä»€ä¹ˆè¦ \n

 æ³¨æ„ ****************************** è¿™é‡Œä¸ºä»€ä¹ˆè¦ \n
			String[] lines = value.split("\n", -1);
		ï¼ˆ1ï¼‰æˆ‘åŸæ¥çš„æ•°æ®é‡Œé¢å°±æœ‰\n ï¼Œæ˜¯åˆ†å‰²ç¬¦å·
		ï¼ˆ2ï¼‰diff åº“çš„å·®å¼‚å— ä¸ä¼šæŒ‰è¡Œåˆ‡å¼€ï¼Œåªæ˜¯åŸå°ä¸åŠ¨æŠŠæ¢è¡Œç¬¦åŒ…å«åœ¨ value é‡Œã€‚
		    å¦‚æœä½ è¦é€è¡Œå¯¹é½å±•ç¤ºï¼ˆè®© source/target ä¸€è¡Œå¯¹åº”ä¸€è¡Œï¼‰ï¼Œé‚£å°±å¿…é¡»è‡ªå·±ç”¨ split("\n") æ¥åˆ‡åˆ†ã€‚
		ï¼ˆ3ï¼‰åœ¨ diff åº“çš„è®¡ç®—é‡Œ \n åªæ˜¯æ™®é€šå­—ç¬¦ï¼Œä¹Ÿä¼šç®—è¿›ç¼–è¾‘è·ç¦»ï¼›

		ï¼ˆ4ï¼‰æˆ‘åŸæ¥æŒ‰ \n åˆ†è¡Œï¼Œå®ƒå¹¶ä¸ä¼šç‰¹åˆ«è¯†åˆ«è¡Œï¼Œåªå½“æˆæ™®é€šå†…å®¹ã€‚
			 Value result = diffLines.execute(sourceContent == null ? "" : sourceContent, targetContent == null ? "" : targetContent);
			 å› ä¸ºå®ƒçš„ä¸¤ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²
			 diffLines.execute(...) æ¥æ”¶çš„å°±æ˜¯ä¸¤ä¸ªå®Œæ•´çš„ å­—ç¬¦ä¸² å‚æ•°ï¼Œé‡Œé¢çš„ \n åªæ˜¯æ™®é€šå­—ç¬¦ï¼Œä¸ä¼šè¢«ç‰¹æ®Šå¤„ç†ã€‚


//===================================================
//===================================================

åˆ†å‰²ç¬¦å·åªä¼šå†³å®šå¯¹æ¯”å—çš„å¤šå°‘ï¼Œä¸ä¼šå½±å“å·®å¼‚å—ï¼Œå› ä¸ºå·®å¼‚å—å†…éƒ¨å¯èƒ½ä¼šåŒ…å«åˆ†å‰²ç¬¦å·ï¼ˆè®¡ç®—ç¼–è¾‘è·ç¦»æ—¶å¾—åˆ°çš„ï¼‰

	åˆ†éš”ç¬¦ï¼šåªå†³å®šæŠŠåŸå§‹å­—ç¬¦ä¸²åˆ‡æˆå¤šå°‘ "æœ€å°å•å…ƒ" ï¼Œ
			ç„¶åè¿™äº›å•å…ƒå†äº¤ç»™ç®—æ³•å»æ¯”å¯¹ â†’ ä¼šå½±å“ "å·®å¼‚å—" çš„ç²’åº¦å¤šå°‘ã€‚

	å·®å¼‚å—å†…éƒ¨ï¼šä»ç„¶å¯èƒ½åŒ…å«åˆ†éš”ç¬¦ï¼ˆæ¯”å¦‚ \nï¼‰ï¼Œ
			ç®—æ³•åœ¨ç®—æœ€çŸ­ç¼–è¾‘è·¯å¾„æ—¶æŠŠå®ƒå½“æ™®é€šå­—ç¬¦å¤„ç†ï¼Œ
			ä¸ä¼šå› ä¸ºä½ å®šä¹‰äº†åˆ†éš”ç¬¦å°±è‡ªåŠ¨æ‹†å¼€ã€‚

å› ä¸ºåœ¨è®¡ç®—"ç®—æ³•å†…éƒ¨çš„ç¼–è¾‘è·ç¦»"æ—¶ï¼Œå®ƒä¼šæŠŠ\nä¹Ÿä¼šå½“æˆ æ™®é€šå­—ç¬¦ä¸²æ”¾åœ¨å…¶ä¸­ï¼Œè‚‰çœ¼ä¸èƒ½ç›´æ¥çœ‹å‡ºå·®å¼‚å—çš„ã€‚



